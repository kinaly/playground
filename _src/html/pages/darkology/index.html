<!doctype html>
<html class="no-js" lang="fr">
<head>
		<meta charset="UTF-8">
		<title>Darkology - A tentative diagram of the Dark series chronology and characters</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="stylesheet" href="/css/darkology.css" media="all">

		<style></style>
</head>
<body>
	{% set chosenEpisode = episodes[episodes.length - 1].id %}
	{% set episodeIndex = -1 %}

	<!-- Find the loop index in episodes of the chosen episode -->
	{% for episode in episodes %}
		{% if episode.id == chosenEpisode %}
			{% set episodeIndex = loop.index0 %}
		{% endif  %}
	{% endfor %}

	<header class="main-header">
		<span class="form-item">
			<label for="episode-switch" class="form-item__label">How far have you watched ?</label>
			<select name="episode-switch" id="episode-switch" class="form-item__select">
				{% for episode in episodes %}
				<option value="{{episode.id}}" {% if episode.id == chosenEpisode %}selected="selected"{% endif %}>{{episode.name}}</option>
				{% endfor %}
			</select>
		</span>
	</header>

	<main class="main-content">

		<div class="map-boundaries">
			<div class="map">
				<div class="map__stripes"></div>
				{% for period in darkPeriods %}
					{% if period.episode <= chosenEpisode %}
				<h2 class="map__time-heading" data-period="{{period.id}}" style="grid-row: header{{period.id}}-start / header{{period.id}}-end">{{period.name}}</h2>

						{% for character in episodes[episodeIndex].knownCharacters %}
				
				
							{% for pcharacter in period.characters %}
								{% if character == pcharacter.id %}
									{% for ppersona in pcharacter.personas %}
										{% if ppersona.episode <= chosenEpisode %}
											{% for dcharacter in darkCharacters %}
												{% if character == dcharacter.id %}
													{% for dpersona in dcharacter.personas %}
														{% if ppersona.id == dpersona.world + "." + dpersona.age %}

															{% set avatar = { 
																"id": dcharacter.id,
																"pic": dpersona.pic,
																"name": dpersona.name,
																"age": dpersona.age,
																"period": period.id
															} %}
															
															{% include "views/dark-avatar.html" %}					
				
														{% endif %}
													{% endfor %}
												{% endif %}
											{% endfor %}
										{% endif %}
									{% endfor %}
								{% endif %}
							{% endfor %}
							
						{% endfor %}

					{% endif %}
				{% endfor %}


				{% for connection in connections %}
					{% include "views/dark-connection.html" %}
				{% endfor %}
				
			</div>
		</div>
		
	</main>
	
	<script src="/js/darkology.js" type="text/javascript"></script>

</body>
</html>